<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Captura de Datos - App de Campo</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body, #map {
      height: 100%; margin: 0; padding: 0;
    }
    .form-popup {
      max-width: 340px; font-family: sans-serif;
    }
    .form-popup h3 {
      margin-top: 0;
      background: #f0f0f0; padding: 8px; border-radius: 4px;
      font-size: 16px;
    }
    label {
      margin: 4px 0 2px; display: block;
    }
    input, select, textarea {
      width: 100%; padding: 6px; margin-bottom: 6px;
      font-size: 14px; border: 1px solid #ccc; border-radius: 4px;
    }
    .grupo {
      margin-bottom: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;
      background: #f9f9f9;
    }
    button {
      margin-top: 6px; padding: 6px 12px;
      font-size: 14px; border: none; border-radius: 4px;
      background: #0066cc; color: white; cursor: pointer;
    }
    button:hover { background: #0055a0; }
  </style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([21.1219, -101.6827], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

fetch('AT_Leon.geojson')
  .then(res => res.json())
  .then(data => L.geoJSON(data, {
    onEachFeature: (feature, layer) => {
      const props = feature.properties;
      layer.on('click', e => {
        const lat = e.latlng.lat.toFixed(6);
        const lng = e.latlng.lng.toFixed(6);
        const fecha = new Date().toLocaleString();
        const formHtml = `
          <div class='form-popup'>
            <h3>Datos personales</h3>
            <label>Nombre</label><input id='nombre'>
            <label>Apellido paterno</label><input id='paterno'>
            <label>Apellido materno</label><input id='materno'>
            <label>Tel√©fono</label><input id='telefono'>
            <label>Calle</label><input id='calle'>
            <label>N√∫mero</label><input id='numero'>

            <div class='grupo'>
              <label>Tipo de zona</label>
              <select id='zona'>
                <option value=''>--Selecciona--</option>
                <option value='urbana'>Urbana</option>
                <option value='rural'>Rural</option>
                <option value='marginada'>Marginada</option>
                <option value='conurbada'>Conurbada</option>
              </select>
              <label>¬øCobertura celular?</label>
              <select id='cobertura'>
                <option value=''>--Selecciona--</option>
                <option>S√≠</option>
                <option>No</option>
              </select>
            </div>

            <h3>Clasificaci√≥n</h3>
            <label>Tipo *</label>
            <select id='tipo'>
              <option value=''>--Selecciona--</option>
              <option>Simpatizante</option>
              <option>Casilla</option>
              <option>Liderazgo</option>
              <option>Activista rival</option>
            </select>

            <label>Foto/Evidencia</label>
            <input type='file' accept='image/*' capture='environment'>

            <label>Observaciones <span style='font-size: 12px;'>üé§ Puedes dictar tocando el micr√≥fono del teclado</span></label>
            <textarea id='observaciones'></textarea>

            <h3>Sistema</h3>
            <label>üåê Coordenadas</label>
            <input value='${lat}, ${lng}' readonly>
            <label>üïí Fecha de captura</label>
            <input value='${fecha}' readonly>

            <button>Guardar</button>
            <button style='background:#aaa;'>Cancelar</button>
          </div>`;
        layer.bindPopup(formHtml).openPopup();
      });
    }
  }).addTo(map));
</script>
</body>
</html>
